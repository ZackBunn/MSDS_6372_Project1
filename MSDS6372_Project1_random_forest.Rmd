---
title: "MSDA6372 Project 1"
author: "Zack Bunn"
date: '2022-05-31'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
setwd("C:/Users/rwbut/Desktop/stats_2/Project1_Summer2022/MSDS_6372_Project1")

library(tseries)
library(forecast)
library(ggplot2)
library(tidyverse)
library(dataexplorer)

lifeX<-read.csv("Life Expectancy Datav2.csv")

ggplot(data = lifeX) +
  geom_bar(mapping = aes(x = Status))

ggplot(data = lifeX, mapping = aes(x = Immunization, colour = Status)) + geom_freqpoly(binwidth = 0.1)

ggplot(data = lifeX, mapping = aes(x = Life.expectancy, colour = Status)) + geom_freqpoly(binwidth = 0.1)

lifeX %>% create_report(y = "Life.expectancy")

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


## Use KNN regression

install.packages("caret")
install.packages("rlang")
install.packages("pROC")
install.packages("mlbench")
## Libraries
library(caret)
library(pROC)
library(mlbench)

## replace empty values with NaN
```{r}
str(lifeX)

lifeX_noNull <- lifeX
lifeX_noNull[lifeX_noNull == ""] <- NaN
lifeX_noNull
lifeX_noNull[!is.na(lifeX_noNull$Life.expectancy),]

```

## create the test and train data sets

``` {r}
set.seed(123)
ind <- sample(2, nrow(lifeX), replace = T, prob = c(0.7, 0.3))
training <- lifeX[ind == 1,]
test <- lifeX[ind ==2,]
```

# KNN Model

``` {r}
train_Control <- trainControl(method = "cv", number = 10)

set.seed(321)

fit <- train(Life.expectancy ~ ., data=training, method = "knn", tuneLength = 20, trControl = train_Control, preProc = c("center", "scale"), na.action = na.omit, importance = TRUE)


fit
ls(fit)
plot(fit)
varImp(fit)
```

## rf model
library(randomForest)

```{r}
set.seed(321)
rf <- randomForest(Life.expectancy~.,data=training, na.action = na.omit, trainControl= train_Control)

print(rf)

attributes(rf)

rf$rsq

## importance of variables 
imp <- as.data.frame(varImp(rf))
imp <- data.frame(overall = imp$Overall, names = rownames(imp))
imp[order(imp$overall,decreasing = T),]

```
## test the rf model
```{r}
rfTest <- predict(rf, test)
print(rfTest)
length(test$Life.expectancy)
summary(rfTest)$r.squared

pvodf <- data.frame(Predicted = rfTest, Observed = test$Life.expectancy)
print(pvodf)
model <- lm(Observed ~ Predicted, data = pvodf)
summary(model)$r.squared
ggplot(pvodf, aes(x=Predicted, y=Observed)) + geom_point() + geom_abline(intercept = 0, slope = 1, color = "red", size = 2)
```


### model Preformance



